# FRAMEWORK MT4 TO DEV AND BACKTEST EA

I made this project to easily develop and backtest Expert Advisors in MetaTrader 4.
The goal was to be able to develop a flexible EA (inputs/outputs, money management, etc.) in a few hours or even less for a simple EA. I wanted to carry out massive backtest campaigns by varying entry, exit and management conditions. And needed to analyze the results of the backtests.
This project can be useful to test all the strategies showed by Youtubers and other dream sellers.

In the end I did 6 EAs, 180 test campaigns, i.e. 640k scenarios and 1.9M backtests. By using a clean backtest protocol (in 3 datasets) to limit overfitting. I haven't found an algorithm doing more than 10% perf per year in a sustainable way. So it's easier to do a DCA strategy on an world ETF world. 
Finally I switched to Python and Machine Learning, stopping MT4 development.

I have done this project in French and partially translated into English. If you are interested by the code, do not hesitate to contact me in case of questions, see support section.

## Repository File Structure

    FWK_EA_MT4
    ├── DB/          		# SQL scripts 
    ├── MQL4/       		# MQL4 code with the MT4's directory structure
        ├── Experts         # 2 EA as examples 
        ├── Include         # librairies of the framweork
        ├── Indicators      # some indicators I developped
        ├── Presets         # 1 preset by EA 
    ├── tester/       		
        ├── files/       	# 1 backtest campaign by EA

## How to install

Copy/Paste MQL4 directory into your MT4 directory (same structure).
If you want to use the DB part, create the database with the script `DB/create_db_trading.sql`. 

## How to use

### Create an EA

The simplest method is to start from one of the two examples provided in MQL4/Experts
`Swing_3_UT_Flex_v1.mq4` : EA for forex, it works with 3 different timeframes to determine the trend and find entry/exit points
`Swing_NNFX_Index.mq4` : EA for index (ex DAX) based on the NNFX method [NNFX Blog](https://nononsenseforex.com/)

The adaptation between the different types of assets is very easy (Forex <-> Index)

It's recommended to calculate the indicators using the getIndicatorFromParam function in `MQL4/Include/APIIndicators.mqh`. There are already  91 coded functions.   You can complete this file (by copy/paste from an existing function)

### Backtest with campaign

If you want to carry out backtest campaigns,  I recommend to use the database part to create the backtest campaigns in a .csv file. For example to test 5000 parameters in one shot for an EA. Then, set the csv file as input in the backtest module of MT4. Finally insert the results into the database to analyze the data.

The DB model is `DB/ERD_trading.png`. If you have questions do not hesitate.

I used Talend jobs to perform these tasks, see screenshots in the DB section.
* A job to generate a campaign file from different csv files containing all the parameters I want to test. The job makes a Cartesian product of the possibilities. Then checks if the scenario has already been tested.
* A job to insert settings, scenarios and campaign into the DB, uses the file generated by the previous job
* A job to insert results from Excel files with data copied from MT4

You can ask me for the jobs code (not very clean)

## Support / Contributing

If you need help using this framework, or if you want to contribute, please create an issue on the <a href="https://github.com/BenoitDurandIndep/FWK_EA_MT4/issues" target="_blank">GitHub repo</a>
You can send me a message on <a href="https://www.linkedin.com/in/bdu8784/" target="_blank">LinkedIn</a>

## Some tips

MT4 is widely used by CFD brokers from Cyprus. If it is a good platform for these brokers, it is not a good sign for users. It's very easy to develop things in this tool and it's more open than other platforms. But the backtesting part isn't great at all and bad backtests lead to losses and so gains for the CFD broker.
I advise to use 3 setup of the tool 1 offline dev, 1 online test on demo, 1 prod on real
For the offline dev, it should never be connected to the broker and it's only used to do devs and massive backtests.
Use your own data files. I use QuantDataManager to download data histories. I don't test low timeframes (at least 30m->1w), data look good enough at these timeframes.
It's very easy to fall into the overfitting trap, if you don't know about it, please google it and learn.

## License

GPL-3.0 license [License](https://github.com/BenoitDurandIndep/Fwk_EA_MT4/blob/main/LICENSE)